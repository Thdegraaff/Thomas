  <head>
    <meta charset="utf-8">
    <title>New Economic Geography model with R | Thomas de Graaff</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Carlito|Source+Code+Pro|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/foundation.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/highlight.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/font-awesome.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/academicons.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/finite.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/kube.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/thomas.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/styles/zenburn.css">
  </head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="thomasdegraaff.nl/"  style="color: #c09f80">Thomas de Graaff</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      



	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="thomasdegraaff.nl/"  style="color: #c09f80;">Thomas de Graaff</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="thomasdegraaff.nl/thomas/">Blog</a></li>
		  
		  <li><a href="thomasdegraaff.nl/publications/">Publications</a></li>
		  
		  <li><a href="thomasdegraaff.nl/seminars/">Seminars</a></li>
		  
		  <li><a href="thomasdegraaff.nl/teaching/">Teaching</a></li>
		  
		  <li><a href="thomasdegraaff.nl/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		



	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>New Economic Geography model with R</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h3 style='padding-top: 0.8ex;'><a style ="color: #f7e1d7;" href="thomasdegraaff.nl/thomas/">Thomas de Graaff</a></h3>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2018-02-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">4 February 2018</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/r">R</a>,
     
    
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/education">Education</a>, 
    
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/interaction">Interaction</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <h2 id="new-economic-geography-model-with-r">New economic geography model with R</h2>
<h3 id="introduction">Introduction</h3>
<p>Why some regions have more economic activiy than others depend on a variety of factors, including regions&rsquo; endowments, good policy and just sheer luck (oftentimes called path dependency). In the 1990s Paul Krugman constructed a model, the Core-Periphery model, that was able to model all these three elements. This model received quite some positive criticism (including a Nobel price), but still is rather complex in wielding it. In this post I show how one can actually program and depict the short term and long term equilibria that the model yields. The derived estimations are coming from Henri de Groot.</p>
<h3 id="the-actual-code">The actual code</h3>
<p>We first need to read in some packages that we will use</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Read in libraries</span>
<span style="color:#75715e">################################################################</span>

<span style="color:#a6e22e">library</span>(nleqslv)  <span style="color:#75715e"># for solving system of nonlinear equations</span>
<span style="color:#a6e22e">library</span>(ggplot2)  <span style="color:#75715e"># for structurally making plots</span>
<span style="color:#a6e22e">library</span>(ggthemes) <span style="color:#75715e"># for using economist theme</span>
<span style="color:#a6e22e">library</span>(dplyr)    <span style="color:#75715e"># for data wrangling</span>
<span style="color:#a6e22e">library</span>(cowplot)  <span style="color:#75715e"># for combining plots</span>
</code></pre></div><p>Then we define some constants. Note that you can change them if you need a different set-up.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Define parameters</span>
<span style="color:#75715e">################################################################</span>

L       <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2.0</span>  <span style="color:#75715e"># Total labor force</span>
phi1    <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.48</span> <span style="color:#75715e"># fraction of food works living in region 1</span>
gam     <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.3</span>  <span style="color:#75715e"># fraction that works in manufacturing</span>
eps     <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">5.0</span>  <span style="color:#75715e"># elasticity of demand</span>
rho     <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.8</span>  <span style="color:#75715e"># substitution parameter of variety</span>
bet     <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.8</span>  <span style="color:#75715e"># variable costs</span>
alp     <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.08</span> <span style="color:#75715e"># fixed costs</span>
delta   <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.4</span>  <span style="color:#75715e"># budget share manufacturing</span>
</code></pre></div><p>Moreover, we need some additional (none structural) constants, but needed for the iteration and the granularity of our plots</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Define iterations and stepsize for transporation and lambda</span>
<span style="color:#75715e">################################################################</span>

iter_l <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">999</span>
step_l <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.001</span>
start_l <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.001</span>

iter_t <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">51</span>
start_t <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1.5</span>
step_t <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0.01</span>
</code></pre></div><p>The model containts 6 non-linear equations, namely:</p>
<p><code>$$\begin{align} Y_1 &amp;= \phi_1(1-\gamma)L + \lambda_1 \gamma LW_1 \\ Y_2 &amp;= \phi_2(1-\gamma)L + (1-\lambda_1) \gamma LW_2 \\ W_1 &amp;= \rho \beta^{-\rho}\left(\frac{\delta}{\alpha(\epsilon-1)}\right)^{1/\epsilon} \left(Y_1 I_1^{\epsilon-1} + T^{1-\epsilon}Y_2 I_2^{\epsilon-1}\right)^{1/\epsilon}\\ W_2 &amp;= \rho \beta^{-\rho}\left(\frac{\delta}{\alpha(\epsilon-1)}\right)^{1/\epsilon} \left(T^{1-\epsilon}Y_1 I_1^{\epsilon-1} + Y_2 I_2^{\epsilon-1}\right)^{1/\epsilon}\\ I_1 &amp;= \left(\frac{\gamma L}{\alpha \epsilon} \right)^{1/(1-\epsilon)}\left(\frac{\beta}{\rho}\right) \left(\lambda W_1^{1-\epsilon} + (1-\lambda)T^{1-\epsilon} W_2^{1-\epsilon}\right)^{1/(1-\epsilon)}\\ I_2 &amp;= \left(\frac{\gamma L}{\alpha \epsilon} \right)^{1/(1-\epsilon)}\left(\frac{\beta}{\rho}\right) \left(\lambda T^{1-\epsilon} W_1^{1-\epsilon} + (1-\lambda) W_2^{1-\epsilon}\right)^{1/(1-\epsilon)}\\ \end{align}$$</code></p>
<p>The first two equations are total regional incomes, equation 3 and 4 give the regional wages and the last two equations determine regional price indices.</p>
<p>Thus, the key optimalisation procedure looks as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Definite optimal function</span>
<span style="color:#75715e">################################################################</span>

equilibrium <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x){
  
    Y1 <span style="color:#f92672">&lt;-</span> x[1]
    Y2 <span style="color:#f92672">&lt;-</span> x[2]
    W1 <span style="color:#f92672">&lt;-</span> x[3]
    W2 <span style="color:#f92672">&lt;-</span> x[4]
    I1 <span style="color:#f92672">&lt;-</span> x[5]
    I2 <span style="color:#f92672">&lt;-</span> x[6]
    
    y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">NA</span>, <span style="color:#a6e22e">length</span>(x))
      
    y[1] <span style="color:#f92672">&lt;-</span> Y1<span style="color:#f92672">-</span>phi1<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>gam)<span style="color:#f92672">*</span>L<span style="color:#f92672">-</span>lam<span style="color:#f92672">*</span>gam<span style="color:#f92672">*</span>L<span style="color:#f92672">*</span>W1
    y[2] <span style="color:#f92672">&lt;-</span> Y2<span style="color:#f92672">-</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>phi1)<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>gam)<span style="color:#f92672">*</span>L<span style="color:#f92672">-</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>lam)<span style="color:#f92672">*</span>gam<span style="color:#f92672">*</span>L<span style="color:#f92672">*</span>W2
    y[3] <span style="color:#f92672">&lt;-</span> W1<span style="color:#f92672">-</span>rho<span style="color:#f92672">*</span>bet<span style="color:#a6e22e">^</span>(<span style="color:#f92672">-</span>rho)<span style="color:#f92672">*</span>(delta<span style="color:#f92672">/</span>(alp<span style="color:#f92672">*</span>(eps<span style="color:#ae81ff">-1</span>)))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>eps)<span style="color:#f92672">*</span>(Y1<span style="color:#f92672">*</span>I1<span style="color:#a6e22e">^</span>(eps<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">+</span>T<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">*</span>Y2<span style="color:#f92672">*</span>I2<span style="color:#a6e22e">^</span>(eps<span style="color:#ae81ff">-1</span>))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>eps)
    y[4] <span style="color:#f92672">&lt;-</span> W2<span style="color:#f92672">-</span>rho<span style="color:#f92672">*</span>bet<span style="color:#a6e22e">^</span>(<span style="color:#f92672">-</span>rho)<span style="color:#f92672">*</span>(delta<span style="color:#f92672">/</span>(alp<span style="color:#f92672">*</span>(eps<span style="color:#ae81ff">-1</span>)))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>eps)<span style="color:#f92672">*</span>(T<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">*</span>Y1<span style="color:#f92672">*</span>I1<span style="color:#a6e22e">^</span>(eps<span style="color:#ae81ff">-1</span>)<span style="color:#f92672">+</span>Y2<span style="color:#f92672">*</span>I2<span style="color:#a6e22e">^</span>(eps<span style="color:#ae81ff">-1</span>))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>eps)
    y[5] <span style="color:#f92672">&lt;-</span> I1<span style="color:#f92672">-</span>(gam<span style="color:#f92672">*</span>L<span style="color:#f92672">/</span>(alp<span style="color:#f92672">*</span>eps))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))<span style="color:#f92672">*</span>(bet<span style="color:#f92672">/</span>rho)<span style="color:#f92672">*</span>(lam<span style="color:#f92672">*</span>W1<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">+</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>lam)<span style="color:#f92672">*</span>T<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">*</span>W2<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))
    y[6] <span style="color:#f92672">&lt;-</span> I2<span style="color:#f92672">-</span>(gam<span style="color:#f92672">*</span>L<span style="color:#f92672">/</span>(alp<span style="color:#f92672">*</span>eps))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))<span style="color:#f92672">*</span>(bet<span style="color:#f92672">/</span>rho)<span style="color:#f92672">*</span>(lam<span style="color:#f92672">*</span>T<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">*</span>W1<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps)<span style="color:#f92672">+</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>lam)<span style="color:#f92672">*</span>W2<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))<span style="color:#a6e22e">^</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>eps))
    
    <span style="color:#a6e22e">return</span>(y)
}
</code></pre></div><p>And finally we need the loop below to create the figures</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Create the vector where the output is stored</span>
<span style="color:#75715e"># This is faster than using append</span>
<span style="color:#75715e"># we will only append the equilibrium dataframe to find the</span>
<span style="color:#75715e"># stable and unstable equiliria (do that in the slower (outer) </span>
<span style="color:#75715e"># loop)</span>
<span style="color:#75715e">################################################################</span>

rel       <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
lambda    <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
transport <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
welfare   <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
w_man_h   <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
w_man_f   <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
w_farm_h  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)
w_farm_f  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l<span style="color:#f92672">*</span>iter_t)

<span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Set the double loop for the  optimal solution using the  </span>
<span style="color:#75715e"># package nleqslv. </span>
<span style="color:#75715e"># The fast (inner) loop is over gamma, The slow (outer) loop is </span>
<span style="color:#75715e"># over the transportation costs</span>
<span style="color:#75715e">################################################################</span>

<span style="color:#75715e"># Completely parameterized</span>
loop_transport <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">seq</span>( start_t, start_t <span style="color:#f92672">+</span> iter_t <span style="color:#f92672">*</span> step_t <span style="color:#f92672">-</span> step_t, by <span style="color:#f92672">=</span> step_t)
loop_gamma <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">seq</span>( start_l, start_l <span style="color:#f92672">+</span> iter_l <span style="color:#f92672">*</span> step_l <span style="color:#f92672">-</span> step_l, by <span style="color:#f92672">=</span> step_l )
equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(T <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">0</span>), gamma <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">0</span>), stable <span style="color:#f92672">=</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">0</span>))

<span style="color:#75715e"># Create intial starting values</span>
start <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)

iteration <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># General counter</span>
<span style="color:#a6e22e">for </span>(T in loop_transport){
  iter_eq <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Counter to find the equilibria for lambda</span>
  lam_vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l) <span style="color:#75715e"># initialize lambda vector</span>
  t_vec   <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l) <span style="color:#75715e"># initialize transport vector</span>
  rel_vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(length <span style="color:#f92672">=</span> iter_l) <span style="color:#75715e"># initialize relative real wage diff vector</span>
  <span style="color:#a6e22e">for </span>(lam in loop_gamma){
    iteration <span style="color:#f92672">&lt;-</span> iteration <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    iter_eq   <span style="color:#f92672">&lt;-</span>  iter_eq <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    opt <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">nleqslv</span>(start, equilibrium)
    Y1 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[1]
    Y2 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[2]
    W1 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[3]
    W2 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[4]
    I1 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[5]
    I2 <span style="color:#f92672">&lt;-</span> opt<span style="color:#f92672">$</span>x[6]
    
    <span style="color:#75715e"># Fill the various vectors</span>
    rel[iteration]       <span style="color:#f92672">&lt;-</span> (W1<span style="color:#f92672">/</span>I1^delta)<span style="color:#f92672">/</span>(W2<span style="color:#f92672">/</span>I2^delta)
    welfare[iteration]   <span style="color:#f92672">&lt;-</span> Y1<span style="color:#f92672">/</span>(I1^delta)<span style="color:#f92672">+</span>Y2<span style="color:#f92672">/</span>(I2^delta)
    w_man_h[iteration]   <span style="color:#f92672">&lt;-</span> W1<span style="color:#f92672">/</span>I1^delta 
    w_man_f[iteration]   <span style="color:#f92672">&lt;-</span> W2<span style="color:#f92672">/</span>I2^delta
    w_farm_h[iteration]  <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>I1^delta 
    w_farm_f[iteration]  <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>I2^delta 
    lambda[iteration]    <span style="color:#f92672">&lt;-</span> lam
    transport[iteration] <span style="color:#f92672">&lt;-</span> T
    
    <span style="color:#75715e"># Needed to find the equilibria (a bit redundant but more readible so)</span>
    lam_vec[iter_eq]     <span style="color:#f92672">&lt;-</span> lam
    t_vec[iter_eq]       <span style="color:#f92672">&lt;-</span> T
    rel_vec[iter_eq]     <span style="color:#f92672">&lt;-</span> (W1<span style="color:#f92672">/</span>I1^delta)<span style="color:#f92672">/</span>(W2<span style="color:#f92672">/</span>I2^delta)
  }
  eq <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(t_vec, lam_vec, rel_vec)
  eq <span style="color:#f92672">&lt;-</span> eq <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">mutate</span>(
           dpos <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>( ( (rel_vec <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span> ( <span style="color:#a6e22e">lag</span>(rel_vec) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)  <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span> ),
           dneg <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>( ( (rel_vec <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span> ( <span style="color:#a6e22e">lag</span>(rel_vec) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)  <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span> )
           )
  stable <span style="color:#f92672">&lt;-</span> eq <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">filter</span>(dneg <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">mutate</span>(stable <span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>dpos)
  unstable <span style="color:#f92672">&lt;-</span> eq <span style="color:#f92672">%&gt;%</span> 
    <span style="color:#a6e22e">filter</span>(dpos <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">mutate</span>(stable <span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">%&gt;%</span>
    <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>dneg)
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">nrow</span>(stable) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">data.frame</span>(stable[1], stable[2], stable[5]))
      } 
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">nrow</span>(unstable) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">data.frame</span>(unstable[1], unstable[2], unstable[5]))
      }
  <span style="color:#a6e22e">if </span>(<span style="color:#a6e22e">nrow</span>(unstable) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>){
    equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))
    equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>))
  }
  <span style="color:#a6e22e">if </span>( (<span style="color:#a6e22e">nrow</span>(unstable) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> (<span style="color:#a6e22e">nrow</span>(stable) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) ) {
    <span style="color:#a6e22e">if </span>(stable<span style="color:#f92672">$</span>lam_vec[1] <span style="color:#f92672">&gt;</span> unstable<span style="color:#f92672">$</span>lam_vec[1] ){
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))
    }  
    <span style="color:#a6e22e">if </span>(stable<span style="color:#f92672">$</span>lam_vec[1] <span style="color:#f92672">&lt;</span> unstable<span style="color:#f92672">$</span>lam_vec[1] ){
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>))
    }
  }
  <span style="color:#a6e22e">if </span>((<span style="color:#a6e22e">nrow</span>(unstable) <span style="color:#f92672">+</span> <span style="color:#a6e22e">nrow</span>(stable)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>) {
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>))
      equilibria <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(equilibria, <span style="color:#a6e22e">c</span>(unstable[1,<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))
  }
}

<span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># Create the dataframe called neg_data</span>
<span style="color:#75715e">################################################################</span>

neg_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(transport, lambda, rel, welfare,
                       w_man_h, w_man_f, w_farm_h, w_farm_f)

<span style="color:#75715e">################################################################</span>
<span style="color:#75715e"># For creating the plots</span>
<span style="color:#75715e">################################################################</span>

<span style="color:#75715e">#Indicate which lines should be highlighted</span>
top_line <span style="color:#f92672">&lt;-</span> neg_data[neg_data<span style="color:#f92672">$</span>transport <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1.5&#34;</span>, ]
bottom_line <span style="color:#f92672">&lt;-</span> neg_data[neg_data<span style="color:#f92672">$</span>transport <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">2&#34;</span>, ]
mid_line <span style="color:#f92672">&lt;-</span> neg_data[neg_data<span style="color:#f92672">$</span>transport <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1.75&#34;</span>, ]
</code></pre></div><p>So we can get our wiggle and tomahawk picture we want:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggplot</span>(neg_data) <span style="color:#f92672">+</span> <span style="color:#a6e22e">aes</span>(lambda, rel, group <span style="color:#f92672">=</span> transport) <span style="color:#f92672">+</span> <span style="color:#a6e22e">geom_line</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">grey&#34;</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_line</span>(data <span style="color:#f92672">=</span> top_line, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> lambda, y <span style="color:#f92672">=</span> rel, group <span style="color:#f92672">=</span> transport, colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">steelblue&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_line</span>(data <span style="color:#f92672">=</span> bottom_line, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> lambda, y <span style="color:#f92672">=</span> rel, group <span style="color:#f92672">=</span> transport, colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">black&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_line</span>(data <span style="color:#f92672">=</span> mid_line, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> lambda, y <span style="color:#f92672">=</span> rel, group <span style="color:#f92672">=</span> transport, colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">red&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_colour_discrete</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Transportation costs&#34;</span>, labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">High&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Medium&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Low&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_hline</span>(yintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">red&#34;</span>, linetype <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_economist</span>() <span style="color:#f92672">+</span>  
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wiggle diagram&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Relative real wage&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Changes in relative real wage with varying lambda and transportation costs&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggplot</span>(equilibria) <span style="color:#f92672">+</span> <span style="color:#a6e22e">aes</span>(t_vec, lam_vec) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(colour <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(stable))) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">theme_economist</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.title<span style="color:#f92672">=</span><span style="color:#a6e22e">element_blank</span>()) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_colour_discrete</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">0&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1&#34;</span>), labels<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Unstable equilibrium&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Stable equilibrium&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Tomahawk&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lambda&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">transportation costs&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>


      <meta itemprop="wordCount" content="1138">
      <meta itemprop="datePublished" content="2018-02-04">
      <meta itemprop="url" content="thomasdegraaff.nl/thomas/new-economic-geography-model-with-r/">

<div class='sans' style="background: #d7cec7; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=thomasdegraaff.nl%2fthomas%2fnew-economic-geography-model-with-r%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=New%20Economic%20Geography%20model%20with%20R. thomasdegraaff.nl%2fthomas%2fnew-economic-geography-model-with-r%2f from @thdegraaff" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=thomasdegraaff.nl%2fthomas%2fnew-economic-geography-model-with-r%2f&amp;title=New%20Economic%20Geography%20model%20with%20R" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=New%20Economic%20Geography%20model%20with%20R&amp;body=thomasdegraaff.nl%2fthomas%2fnew-economic-geography-model-with-r%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="thomasdegraaff.nl/thomas/2017-12-22-migrating/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Migrating from Jekyll to Hugo</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="thomasdegraaff.nl/thomas/2018-05-01-barriersofculturenetworksandlanguage/"><em>Next<span class="show-for-sr"> page</span></em>: Barriers of Culture, Networks, and Language&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="thomasdegraaff.nl/hyndsight/">All posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'thomasdegraaff-nl';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <h3>About me</h3>
      <figure class='image-left'>
      <a href="thomasdegraaff.nl/" style="border-bottom: none;">
      	<img src="thomasdegraaff.nl/img/Thomas.jpg" alt="Portrait of the author" height="120" width="120" class='avatar'>
      </a>
  </figure>
  <p>
      I am an assistant professor employed at the <a href=http://www.spatialeconomics.nl/> department of spatial economics </a> at the <a href=http://www.vu.nl/> Vrije Universiteit Amsterdam </a>. This is my personal website and nothing in here is endorsed by the Vrije Universiteit Amsterdam.
    </div>
    <div class="column small-12 medium-4">
      
      <h3 id="contact">Contact</h3>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://sbe.vu.nl/nl/afdelingen-en-instituten/spatial-economics/index.aspx">Department of Spatial Economics, School of Business and Economics, Vrije Universiteit Amsterdam, The Netherlands</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:t.de.graaff@vu.nl">t.de.graaff@vu.nl</a></li>
	
	<li><i class="fa-li fa fa-linkedin-square" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.linkedin.com/in/thomas-de-graaff-1661636/">Thomas de Graaff</a> on linkedin</li>
	
	<li><i class="fa-li fa fa-github" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/Thdegraaff/">Thdegraaff</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=q46f0_YAAAAJ">Google Scholar</a></li>
	
	<li><i class="fa-li ai ai-researchgate" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.researchgate.net/profile/Thomas_Graaff">Research gate</a></li>
	
      </ul>
    </div>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    });
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    
    <div class="column small-12 medium-4">
      <h3>Search</h3>

      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value=http://www.thomasdegraaff.nl/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
        <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
            and <a href="http://spacemacs.org">Spacemacs</a>.
            &copy; <a href="https://thomasdegraaff.nl">Thomas&nbsp;de&nbsp;Graaff</a> 2014&ndash;2020. Original design by <a href="https://robjhyndman.com/">Rob J Hyndman</a> based on <a href="https://kieranhealy.org/">Kieran Healy</a>'s design.
    </section>
    </footer>
    </div>

    <script src="thomasdegraaff.nl/js/jquery.js"></script>
    <script src="thomasdegraaff.nl/js/what-input.js"></script>
    <script src="thomasdegraaff.nl/js/foundation.min.js"></script>
    <script src="thomasdegraaff.nl/js/finite.js"></script>

    
    <script src="thomasdegraaff.nl/js/highlight.pack.js"></script>
    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>

    <script>
     hljs.configure({languages: []});
     hljs.initHighlightingOnLoad();
    </script>

    
    


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-110560967-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
