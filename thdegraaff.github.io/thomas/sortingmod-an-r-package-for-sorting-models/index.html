  <head>
    <meta charset="utf-8">
    <title>Sortingmod: an R-package for sorting models | Thomas de Graaff</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Carlito|Source+Code+Pro|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/foundation.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/highlight.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/font-awesome.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/academicons.min.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/finite.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/kube.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/thomas.css">
    <link rel="stylesheet" href="thomasdegraaff.nl/css/styles/zenburn.css">
  </head>
  <body>
    <header>
      <nav class="nav-bar">
	
	  <div class="title-bar" data-responsive-toggle="site-menu" data-hide-for="medium">
	    <button class="site-hamburger" type="button" data-toggle>
	      <i class="fa fa-bars fa-lg" aria-hidden="true"></i>
	    </button>
	    <div class="title-bar-title site-title">
	      <a href="thomasdegraaff.nl/"  style="color: #c09f80">Thomas de Graaff</a>
	    </div>
	    <div class="title-bar-right pull-right">
	      



	    </div>
	  </div>

	  
	    <div class="top-bar" id="site-menu" >
	      <div class="top-bar-title show-for-medium site-title">
		<a href="thomasdegraaff.nl/"  style="color: #c09f80;">Thomas de Graaff</a>
	      </div>
	      <div class="top-bar-left">
		<ul class="menu vertical medium-horizontal">
		  
		  
		  <li><a href="thomasdegraaff.nl/thomas/">Blog</a></li>
		  
		  <li><a href="thomasdegraaff.nl/publications/">Publications</a></li>
		  
		  <li><a href="thomasdegraaff.nl/seminars/">Seminars</a></li>
		  
		  <li><a href="thomasdegraaff.nl/teaching/">Teaching</a></li>
		  
		  <li><a href="thomasdegraaff.nl/about/">About</a></li>
		  
		</ul>
	      </div>
	      <div class="top-bar-right show-for-medium">
		



	      </div>
	    </div>
	  
	</nav>
    </header>
    <main>
      

<div class="wrapper">
<div class="units-row" style='margin-bottom: 0px;'>
<div class="unit-20">&nbsp;</div>
<div class="unit-60"><h1>Sortingmod: an R-package for sorting models</h1></div>
</div>
<div class="units-row">
  <div class="unit-20 dateblock" style='text-align: right;'><h3 style='padding-top: 0.8ex;'><a style ="color: #f7e1d7;" href="thomasdegraaff.nl/thomas/">Thomas de Graaff</a></h3>
      <div class="post-metadata">
  <span class="post-date">
    <time datetime="2017-09-08 00:00:00 &#43;0000 UTC" itemprop="datePublished">8 September 2017</time>
  </span>
  
  
  
  <span class="post-tags">
    <p><i class="fa fa-tags"></i>
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/heterogeneity">Heterogeneity</a>,
     
    
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/reproducability">Reproducability</a>, 
    
    
    <a class="post-tag" href="thomasdegraaff.nl/categories/r">R</a>
    
  </span>
  
  
</div>

    </div>
<div class="unit-60">

  <h2 id="overview">Overview</h2>
<p>sortingmod is a package for estimating the sorting model - a discrete choice model which explains the location decision of heterogeneous individuals over a set of alternative locations. The model is developed by Bayer et al. (2004) following the work of Berry et al. (1995). It relies on the assumptions that individuals choose a location that maximizes their utility, and that heterogeneous individuals with different characteristics have different preferences, and different valuation for location characteristics. The results of the model provide choice probabilities for each alternative, as well as insight on the valuation patterns of heterogeneous agents, and marginal willingness-to-pay values for location characteristics. For the R-vignette go to <a href="http://www.thomasdegraaff.nl/sortingmod">http://www.thomasdegraaff.nl/sortingmod</a>.</p>
<p>The package is constructed as an accompanying tool for the Summer School in “Hedonic price analysis and the residential location choice”, hosted by the Kraks Fond - Institute for Urban Economic Research (Copenhagen, Denmark).</p>
<h2 id="installation">Installation</h2>
<p><code>sortingmod</code> is not currently available from CRAN, but you can install the development version from github with (note that you need to install the package <code>devtools</code> to be able to install packages from GitHub:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">devtools&#34;</span>)
<span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">devtools&#34;</span>)
devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">thdegraaff/sortingmod&#34;</span>)
</code></pre></div><p>Once installation is completed, the package can be loaded as follows</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(sortingmod)
</code></pre></div><h2 id="components">Components</h2>
<ul>
<li><code>first_stage(code_name, Z_names, X_names, data, print_detail = 3)</code> - Estimates the first stage of a. sorting model</li>
<li><code>second_stage(s1.results, data, endog = NULL, instr = NULL)</code> - Estimates the second of a sorting model</li>
<li><code>sorting_inst(s1.results, endog, data, n.iterations = 3, stepsize = 0.05, threshold = 0.0005)</code> - Calculates an instrument for an endogenous variable in a sorting model setting</li>
</ul>
<p>The data for the estimation should be in data frame format, and it must contain:</p>
<ul>
<li>One or more columns indicating characteristics (<code>Z_names</code>) of a unique agent making a discrete choice between available alternatives (individuals, households, etc.).</li>
<li>A vector indicating the chosen alternative (<code>code_name</code>).</li>
<li>One or more columns indicating characteristics (<code>X_names</code>) of the chosen alternative.</li>
<li>Each row of the data frame should represent a unique individual. The number of alternatives should therefore be smaller or equal to the number of individuals.</li>
<li>Individual and alternative characteristics should be numeric variables. Factor variables are not yet supported, so it's best to transform them into numeric dummy variables if you intend to include them in the model.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Define dataset, alternative identifier variable and explanatory variable sets X and Z</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">data <span style="color:#f92672">&lt;-</span> municipality
</code></pre></div><p>Estimate the first stage of the sorting model</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">X.vars <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lnprice&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nature&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">monuments&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">schools_3km&#34;</span>)
Z.vars <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">income&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">double_earner_hh&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">hh_kids&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">age&#34;</span>)
Alt.var <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">mun_code&#34;</span>
s1.results <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">first_stage</span>(code_name <span style="color:#f92672">=</span> Alt.var,
                          X_names <span style="color:#f92672">=</span> X.vars
                          Z_names <span style="color:#f92672">=</span> Z.vars,
                          data <span style="color:#f92672">=</span> data,
                          print_detail <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</code></pre></div><p>Estimate the second stage of the model, assuming exogeneity of explanatory variables</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">s2.results <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">second_stage</span>(s1.results, data)
</code></pre></div><p>Define endogenous variables and calculate an instrument based on equilibrium conditions. Estimate the second stage of the sorting model using the calculated instrument.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">endog <span style="color:#f92672">&lt;-</span> (<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lnprice&#34;</span>)
phat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sorting_inst</span>(s1.results, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lnprice&#34;</span>, data, stepsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.02</span>)
<span style="color:#a6e22e">plot</span>(phat<span style="color:#f92672">$</span>sorting_inst, phat<span style="color:#f92672">$</span>endogenous, xlab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Instrument&#34;</span>, ylab<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Endogeneous variable&#34;</span>)
</code></pre></div><p>Estimate the second stage of the model, using instruments for the endogenous variables.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">instruments <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind</span>(sorting_inst <span style="color:#f92672">=</span> phat<span style="color:#f92672">$</span>sorting_inst, historical.monuments <span style="color:#f92672">=</span> monuments)
s2.results <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">second_stage</span>(s1.results, data, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lnprice&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">cafes_1km&#34;</span>), instruments)
</code></pre></div><h2 id="getting-help">Getting help</h2>
<p>If you need assistance using <code>sortingmod</code>, you can get in touch by emailing <a href="t.de.graaff@vu.nl">t.de.graaff@vu.nl</a> or <a href="o.d.levkovich@vu.nl">o.d.levkovich@vu.nl</a>.</p>
<h2 id="references">References</h2>
<p>Bayer, P., McMillan, R., &amp; Rueben, K. (2004). An equilibrium model of sorting in an urban housing market (No. w10865). National Bureau of Economic Research.</p>
<p>Berry, S., Levinsohn, J., &amp; Pakes, A. (1995). Automobile prices in market equilibrium. Econometrica: Journal of the Econometric Society, 841-890.</p>


      <meta itemprop="wordCount" content="562">
      <meta itemprop="datePublished" content="2017-09-08">
      <meta itemprop="url" content="thomasdegraaff.nl/thomas/sortingmod-an-r-package-for-sorting-models/">

<div class='sans' style="background: #d7cec7; padding: 2em;">
<div style="padding-bottom: 1em" >
<div class="share-box">
  <ul class="share">
    <li>
      <a class="facebook" href="http://www.facebook.com/sharer.php?u=thomasdegraaff.nl%2fthomas%2fsortingmod-an-r-package-for-sorting-models%2f" target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter" href="https://twitter.com/intent/tweet?text=Sortingmod%3a%20an%20R-package%20for%20sorting%20models. thomasdegraaff.nl%2fthomas%2fsortingmod-an-r-package-for-sorting-models%2f from @thdegraaff" target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=thomasdegraaff.nl%2fthomas%2fsortingmod-an-r-package-for-sorting-models%2f&amp;title=Sortingmod%3a%20an%20R-package%20for%20sorting%20models" target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="email" href="mailto:?subject=Sortingmod%3a%20an%20R-package%20for%20sorting%20models&amp;body=thomasdegraaff.nl%2fthomas%2fsortingmod-an-r-package-for-sorting-models%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


</div>

    <ul class="pagination" role="navigation" aria-label="Pagination">
      
      <li class="arrow" aria-disabled="true"><a href="thomasdegraaff.nl/thomas/choosing-statistical-software-package-for-education-in-the-social-sciences/">&laquo; <em>Previous<span class="show-for-sr"> page</span></em>: Choosing statistical software packages for education in the social sciences</a></li>
      
      
      <li class="arrow" aria-disabled="true"><a href="thomasdegraaff.nl/thomas/2017-12-22-migrating/"><em>Next<span class="show-for-sr"> page</span></em>: Migrating from Jekyll to Hugo&nbsp;&raquo;</a></li>
      
    </ul>
    <a href="thomasdegraaff.nl/hyndsight/">All posts by date</a>
</div>

<span style='font-family: Carlito'>
 <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
              return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'thomasdegraaff-nl';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</span>

  </div>
  </div></div>

    </main>
    <footer class="whatisthis">
  <hr class='separator'/>
  <span style="font-family: Carlito, sans; font-size: 0.9em; line-height: 1.05em;">
  <div class="row">
    <div class="column small-12 medium-4">
      <h3>About me</h3>
      <figure class='image-left'>
      <a href="thomasdegraaff.nl/" style="border-bottom: none;">
      	<img src="thomasdegraaff.nl/img/Thomas.jpg" alt="Portrait of the author" height="120" width="120" class='avatar'>
      </a>
  </figure>
  <p>
      I am an assistant professor employed at the <a href=http://www.spatialeconomics.nl/> department of spatial economics </a> at the <a href=http://www.vu.nl/> Vrije Universiteit Amsterdam </a>. This is my personal website and nothing in here is endorsed by the Vrije Universiteit Amsterdam.
    </div>
    <div class="column small-12 medium-4">
      
      <h3 id="contact">Contact</h3>
      <ul class="fa-ul">
	
	<li><i class="fa-li fa fa-university" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://sbe.vu.nl/nl/afdelingen-en-instituten/spatial-economics/index.aspx">Department of Spatial Economics, School of Business and Economics, Vrije Universiteit Amsterdam, The Netherlands</a></li>
	
	<li><i class="fa-li fa fa-envelope" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="mailto:t.de.graaff@vu.nl">t.de.graaff@vu.nl</a></li>
	
	<li><i class="fa-li fa fa-linkedin-square" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.linkedin.com/in/thomas-de-graaff-1661636/">Thomas de Graaff</a> on linkedin</li>
	
	<li><i class="fa-li fa fa-github" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://github.com/Thdegraaff/">Thdegraaff</a> on GitHub</li>
	
	<li><i class="fa-li ai ai-google-scholar" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://scholar.google.com/citations?user=q46f0_YAAAAJ">Google Scholar</a></li>
	
	<li><i class="fa-li ai ai-researchgate" style="color:#03396c;font-size:80%;padding-top:6px;"></i><a href="https://www.researchgate.net/profile/Thomas_Graaff">Research gate</a></li>
	
      </ul>
    </div>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    });
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    
    <div class="column small-12 medium-4">
      <h3>Search</h3>

      <a id="searchsite">
	<form method="get" action="https://duckduckgo.com/">
	  <label for="search-field" class="show-for-sr">Search the site</label>
	  <input type="search" name="q" maxlength="255" placeholder="Search the site" id="search-field">
	  <input type="hidden" name="sites" value=http://www.thomasdegraaff.nl/>
	  <input type="hidden" name="k7" value="#faf8f8"/>
	  <input type="hidden" name="kj" value="#b33"/>
	  <input type="hidden" name="ky" value="#fafafa"/>
	  <input type="hidden" name="kx" value="b"/>
	  <input type="hidden" name="ko" value="-1"/>
	  <input type="hidden" name="k1" value="-1"/>
	  <input type="submit" value="DuckDuckGo Search" style="visibility: hidden;" />
	</form>
      </a>
    </div>
  </div>
  </span>
</footer>

    <div class="endofpage">
    <footer id="footer">
        <section class="wrapper small">Powered by <a href="http://gohugo.io">Hugo</a>
            and <a href="http://spacemacs.org">Spacemacs</a>.
            &copy; <a href="https://thomasdegraaff.nl">Thomas&nbsp;de&nbsp;Graaff</a> 2014&ndash;2020. Original design by <a href="https://robjhyndman.com/">Rob J Hyndman</a> based on <a href="https://kieranhealy.org/">Kieran Healy</a>'s design.
    </section>
    </footer>
    </div>

    <script src="thomasdegraaff.nl/js/jquery.js"></script>
    <script src="thomasdegraaff.nl/js/what-input.js"></script>
    <script src="thomasdegraaff.nl/js/foundation.min.js"></script>
    <script src="thomasdegraaff.nl/js/finite.js"></script>

    
    <script src="thomasdegraaff.nl/js/highlight.pack.js"></script>
    
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>

    <script>
     hljs.configure({languages: []});
     hljs.initHighlightingOnLoad();
    </script>

    
    


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-110560967-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

 </body>
</html>
